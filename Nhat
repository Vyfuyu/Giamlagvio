--[[
    Script: AIO Optimization Menu - SINGULARITY V5
    Tác giả: Gemini
    Cập nhật: Thêm chế độ sụp đổ hình học, triệt tiêu hiệu ứng thời gian thực, không gian chết.
]]

--// SERVICES //--
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local Debris = game:GetService("Debris")

--// PLAYER & CHARACTER //--
local LocalPlayer = Players.LocalPlayer

--// UI CONFIG //--
local THEME = {
    BackgroundColor = Color3.fromRGB(20, 18, 25), -- Deep Purple/Black
    AccentColor = Color3.fromRGB(138, 43, 226), -- BlueViolet
    TextColor = Color3.fromRGB(255, 255, 255),
    ToggledColor = Color3.fromRGB(190, 100, 255),
    Font = Enum.Font.SourceSansPro
}

--// MAIN GUI //--
local AioGui = game.Players.LocalPlayer.PlayerGui:FindFirstChild("AioOptimizationGui") or Instance.new("ScreenGui")
AioGui.Name = "AioOptimizationGui"; AioGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
AioGui.ResetOnSpawn = false; AioGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
for _,v in ipairs(AioGui:GetChildren()) do v:Destroy() end -- Xóa UI cũ

--// MENU TOGGLE BUTTON //--
local OpenButton = Instance.new("TextButton")
OpenButton.Name = "OpenButton"; OpenButton.Size = UDim2.new(0, 100, 0, 30)
OpenButton.Position = UDim2.new(0, 15, 0, 15); OpenButton.Text = "Singularity"
OpenButton.TextColor3 = THEME.TextColor; OpenButton.BackgroundColor3 = THEME.AccentColor
OpenButton.Font = THEME.Font; OpenButton.TextSize = 16; OpenButton.Parent = AioGui
local UICorner_Open = Instance.new("UICorner", OpenButton); UICorner_Open.CornerRadius = UDim.new(0, 8)

--// MAIN FRAME //--
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"; MainFrame.Size = UDim2.new(0, 240, 0, 420)
MainFrame.Position = UDim2.new(0, -250, 0, 55); MainFrame.BackgroundColor3 = THEME.BackgroundColor
MainFrame.BorderSizePixel = 0; MainFrame.Active = true; MainFrame.Draggable = true
MainFrame.Parent = AioGui
local UICorner_Main = Instance.new("UICorner", MainFrame); UICorner_Main.CornerRadius = UDim.new(0, 10)
local UIStroke_Main = Instance.new("UIStroke", MainFrame); UIStroke_Main.Color = THEME.AccentColor
UIStroke_Main.Thickness = 1.5

--// FRAME TITLE //--
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "Title"; TitleLabel.Size = UDim2.new(1, 0, 0, 40)
TitleLabel.Text = "Singularity V5"; TitleLabel.TextColor3 = THEME.AccentColor
TitleLabel.BackgroundTransparency = 1; TitleLabel.Font = Enum.Font.SciFi
TitleLabel.TextSize = 26; TitleLabel.Parent = MainFrame

--// SCROLLING FRAME //--
local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Size = UDim2.new(1, 0, 1, -40); ScrollingFrame.Position = UDim2.new(0, 0, 0, 40)
ScrollingFrame.BackgroundTransparency = 1; ScrollingFrame.BorderSizePixel = 0
ScrollingFrame.ScrollBarImageColor3 = THEME.AccentColor; ScrollingFrame.ScrollBarThickness = 6
ScrollingFrame.Parent = MainFrame
local UIListLayout = Instance.new("UIListLayout", ScrollingFrame)
UIListLayout.Padding = UDim.new(0, 8); UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end)

--// MENU TOGGLE LOGIC //--
local menuVisible = false
local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
OpenButton.MouseButton1Click:Connect(function()
    menuVisible = not menuVisible
    local targetPosition = menuVisible and UDim2.new(0, 15, 0, 55) or UDim2.new(0, -250, 0, 55)
    TweenService:Create(MainFrame, tweenInfo, { Position = targetPosition }):Play()
end)

--// HELPER FUNCTIONS //--
local function createButton(text, callback, parent)
    parent = parent or ScrollingFrame; local btn = Instance.new("TextButton")
    btn.Name = text; btn.Size = UDim2.new(1, -15, 0, 35); btn.Text = text
    btn.TextColor3 = THEME.TextColor; btn.BackgroundColor3 = Color3.fromRGB(40, 38, 45)
    btn.Font = THEME.Font; btn.TextSize = 16; btn.Parent = parent
    local UICorner_Btn = Instance.new("UICorner", btn); UICorner_Btn.CornerRadius = UDim.new(0, 6)
    if callback then btn.MouseButton1Click:Connect(callback) end; return btn
end

local function createToggleButton(text, callbackOn, callbackOff)
    local btn = createButton(text, nil); local toggled = false
    local function updateVisuals()
        btn.BackgroundColor3 = toggled and THEME.ToggledColor or Color3.fromRGB(40, 38, 45)
        btn.TextColor3 = toggled and Color3.fromRGB(0,0,0) or THEME.TextColor
    end
    btn.MouseButton1Click:Connect(function()
        toggled = not toggled; updateVisuals()
        if toggled and callbackOn then callbackOn() elseif not toggled and callbackOff then callbackOff() end
    end); return btn
end

local function createSection(text)
    local label = Instance.new("TextLabel", ScrollingFrame); label.Size = UDim2.new(1, -15, 0, 20)
    label.Text = `--- {text} ---`; label.TextColor3 = THEME.TextColor
    label.BackgroundTransparency = 1; label.Font = Enum.Font.Code; label.TextSize = 14
    return label
end

--// ===== FEATURES ===== //--

createSection("Thực Tại Sụp Đổ")

createButton("Sụp Đổ Hình Học", function(btn)
    btn.Text = "ĐANG XỬ LÝ..."
    task.wait()
    local partsToReplace = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if (obj:IsA("MeshPart") or (obj:IsA("Part") and obj.Shape ~= Enum.PartType.Block)) and not obj:IsDescendantOf(LocalPlayer.Character) then
            table.insert(partsToReplace, obj)
        end
    end
    
    for _, part in ipairs(partsToReplace) do
        if part and part.Parent then
            local newPart = Instance.new("Part")
            newPart.Size = part.Size
            newPart.CFrame = part.CFrame
            newPart.Anchored = part.Anchored
            newPart.Color = Color3.fromRGB(50,50,50)
            newPart.Material = Enum.Material.SmoothPlastic
            newPart.Parent = part.Parent
            part:Destroy()
        end
    end
    btn.Text = "HÌNH HỌC ĐÃ SỤP ĐỔ"
    btn.BackgroundColor3 = THEME.AccentColor
end)

local effectAnnihilatorConnection
local effectBlacklist = {"ParticleEmitter", "Trail", "Beam", "Smoke", "Fire", "Light", "Explosion", "Sound"}
createToggleButton("Triệt Tiêu Hiệu Ứng (Real-time)", function()
    effectAnnihilatorConnection = workspace.DescendantAdded:Connect(function(descendant)
        if table.find(effectBlacklist, descendant.ClassName) then
            descendant:Destroy()
        end
    end)
end, function()
    if effectAnnihilatorConnection then effectAnnihilatorConnection:Disconnect() end
end)


createButton("Không Gian Chết", function(btn)
    Lighting.ClockTime = 0
    Lighting.Brightness = 0
    Lighting.Ambient = Color3.new(0,0,0)
    Lighting.OutdoorAmbient = Color3.new(0,0,0)
    local sky = Lighting:FindFirstChildOfClass("Sky")
    if sky then
        sky.SkyboxBk, sky.SkyboxDn, sky.SkyboxFt, sky.SkyboxLf, sky.SkyboxRt, sky.SkyboxUp = "", "", "", "", "", ""
        sky.StarCount = 0
    end
    btn.Text = "ĐÃ TẮT BẦU TRỜI"
end)


createSection("Tối Ưu Cũ")

createToggleButton("Giới Hạn Tầm Nhìn (Động)", function()
    RunService:BindToRenderStep("RenderDistance", Enum.RenderPriority.Camera.Value + 1, function()
        local char = LocalPlayer.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then return end
        local playerPos = char.HumanoidRootPart.Position
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("BasePart") and not v:IsDescendantOf(LocalPlayer.Character) and v.Parent and v.Name ~= "Terrain" then
                v.LocalTransparencyModifier = (v.Position - playerPos).Magnitude > 200 and 1 or 0
            end
        end
    end)
end, function()
    RunService:UnbindFromRenderStep("RenderDistance")
    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") then v.LocalTransparencyModifier = 0 end
    end
end)


createButton("Ép Xung Đồ Họa & Vật Lý", function()
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    Lighting.GlobalShadows = false
end)


createButton("Xóa Toàn Bộ Map", function()
    local char = LocalPlayer.Character
    for _, v in ipairs(workspace:GetChildren()) do if v ~= char and v.Name ~= "Terrain" then v:Destroy() end end
    local base = Instance.new("Part", workspace)
    base.Size = Vector3.new(4096, 1, 4096)
    base.Position = char.HumanoidRootPart.Position - Vector3.new(0, 20, 0)
    base.Anchored = true; base.Color = Color3.fromRGB(10,10,10)
end)

local singularityButton = createButton("KÍCH HOẠT SINGULARITY", nil, MainFrame)
singularityButton.LayoutOrder = -99
singularityButton.BackgroundColor3 = THEME.AccentColor
singularityButton.TextColor3 = Color3.new(1,1,1)
singularityButton.Font = Enum.Font.GothamBlack

singularityButton.MouseButton1Click:Connect(function()
    for _, btn_obj in ipairs(ScrollingFrame:GetChildren()) do
        if btn_obj:IsA("TextButton") then
            local name = btn_obj.Name
            if name == "Triệt Tiêu Hiệu Ứng (Real-time)" or name == "Giới Hạn Tầm Nhìn (Động)" then
                if btn_obj.BackgroundColor3 ~= THEME.ToggledColor then btn_obj.MouseButton1Click:Fire() end
            end
            if name == "Sụp Đổ Hình Học" or name == "Không Gian Chết" or name == "Ép Xung Đồ Họa & Vật Lý" then
                btn_obj.MouseButton1Click:Fire()
            end
        end
    end
    singularityButton.Text = "THỰC TẠI ĐÃ SỤP ĐỔ"
    singularityButton.BackgroundColor3 = Color3.fromRGB(80, 200, 120) -- Green
end)
